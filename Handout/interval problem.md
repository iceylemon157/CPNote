###### tags: `明道校隊培訓計畫`
# 區間問題

作者：iceylemon157

## 線段樹

線段樹是一種支援動態修改並維護區間資訊的一種資料結構。那當然，如果題目沒有特別要求"動態修改"的話就不一定要用到線段樹了。有時候可以用更快更方便的 **前綴和** 來取代線段樹。

* 關於線段樹需要掌握的一些小知識(技巧)

    1. 單點修改不要寫lazy tag，很累
    2. 區間修改要記得寫lazy tag，每次修改前都要先下傳
    3. lazy tag 需要有兩個條件：
        * 可疊加性：當把新的懶人標記覆蓋在舊的上面時,疊加後的樣子要能夠被維護。
        * 可預測性:當把懶人標記修改到一個線段樹的節點上時,該節點上資訊的變化必須要能夠先被提早知道。
    4. 處理靜態區間問題如果可以請用前綴和
    5. 千萬不要看到題目就先刻線段樹，時間很寶貴，先想想這題到底可不可以用線段樹再刻下去

### 經典問題

* [單點修改查詢區間和](https://cses.fi/problemset/task/1648)
* [單點修改查詢區間max](https://vjudge.net/contest/378075#problem/B)
* [區間加值查詢區間和](https://cses.fi/problemset/task/1651) 他題目雖然給的是單點查詢，但其實寫區間查詢就可以了
* [靜態查詢區間xor](https://cses.fi/problemset/result/1374034/) 注意一下這題的題目是靜態查詢喔
* [線段樹上二分搜](https://cses.fi/problemset/task/1143) 什麼叫線段樹上二分搜呢？其實就是在遞迴的時候加上一些判斷條件判斷我的答案在左子樹還是右子樹。寫法事實上跟單點修改差不多。

### 一些練習題

* [單點修改查詢區間最大前綴和](https://cses.fi/problemset/task/2166)
* [區間加值+區間改值+區間查詢](https://cses.fi/problemset/task/1735) 這題有區間加值跟區間改值，我們要想的是要怎麼維護我們的lazy tag。


### 稍微困難的經典題

經典題是什麼呢？通常就是很難或是想法很特殊
的題目，但是因為大家都看過所以他變得經典。如果解不出來也沒關係，歡迎來問講師。

* [區間開根號+查詢區間和](https://vjudge.net/contest/378075#problem/H) 區間開根號是什麼鬼？這個怎麼想都不能lazy tag吧？ (因為懶標需要有可疊加性) 也就代表說這題沒辦法作到區間修改。那我要怎麼做呢？(這題需要一點觀察)
* [單點修改+區間連續最大和](https://cses.fi/problemset/task/1190) 這題在陣列上是一個經典的DP問題，但是我現在想要詢問的是區間，所以我要維護的是區間。那我現在要做的事情就是我要怎麼用線段樹維護區間，或者說對於一個節點，我要怎麼利用他的左右子樹來更新他的答案
* [(離線)靜態區間相異元素個數](https://www.spoj.com/problems/DQUERY/en/) 這題的線段樹要維護的東西跟作法都非常酷，大家可以想一下。值得一提的是，這題的線段樹作法是離線作法。也就是說我們要先把詢問吃進來之後對他做一些處理最後全部處理完再一次輸出。
* [(在線)靜態區間相異元素個數](https://www.spoj.com/problems/DQUERY/en/) 跟上一題的題目是一樣的，但是希望大家可以用在線的作法也打一次。這題如果要作到在線的話就不能單單只是用線段樹了。我們要用一個線段樹的進化版本 -- 可持久化線段樹。
* 什麼是離線跟在線呢？可以看到下面的定義。
    * 離線：先給你所有詢問，你可以慢慢回答
    * 在線：對於每一組詢問你都必須立即回答
* [區間mex](https://www.luogu.com.cn/problem/P4137) 這題比較難，但事實上跟相異元素個數那題長的87%像。作法一樣有離線跟在線，作法就不多說了。
* 一個題外話，上述的那兩題都有線段樹跟持久化線段樹的作法，複雜度都是 $O(NlogN)$。但事實上，如果題目是離線查詢的話，還有另外一種複雜度比較高的離線算法叫做**莫隊算法**。他做區間mex這題的複雜度會是$O(N\sqrt{N}logN)$ 看起來超爛，但是如果你很會壓常數的話實際上 $2\cdot10^5$ 的測資也是有機會過得了。
* 在打這份講義的時候我還沒有學到這個，事實上這題可以用**回滾莫隊**的技巧做到 $O(N\sqrt N)$ 詳細要怎麼做可以問選訓大電神。

### 綜合習題

這裡會放一些經典題目或是我覺得有趣的線段樹的題目給大家練習。

1. **[[CF 920F]](https://codeforces.com/contest/920/problem/F)**
2. **[[CF 863E]](https://codeforces.com/problemset/problem/863/E)**


## BIT

## Sparse Table

## 莫隊算法